<%- include('parts/header.ejs') %>
<body>
<%- include('parts/navbar.ejs') %>
<div class="container font py-3 px-3">
    <form method="post" onsubmit= " return checkForm()">
        <div class="input-group mb-3 ">
            <input type="text" class="form-control border-dark " placeholder="Order#" id='oid' name='oid'>
            <div class="input-group-append">
                <button class="btn btn-outline-secondary border-dark" type="submit" ><i class="fas fa-search"></i> <b>Search</b></button>
            </div>
        </div>
        <p id="oidHelp" class="form-text text-muted"></p>
    </form>
    <div class="card border-dark card mb-3" style="max-width: 30rem;background-color:bisque">
        <div class="card-header">
            <h3>Order#: <span class='oid'></span><i class="fas fa-pizza-slice"></i></h3>
        </div>
        <div class="card-body text-dark">
            <h5 class="card-title ">訂單資料:</h5>
            <p class="card-text-weight-bold container">
                姓名: <span class='name'></span> <br>
                E-mail: <span class='email'></span> <br>
                手機號碼: <span class='cellnumber'></span> <br>
                下單時間: <span class='odate'></span> <br>
                配料:
            </p>
        </div>

    </div>

</div>
<script>
    var $oid = $("#oid");
    var btn = $(".btn");
    var $msg = $("#oidHelp")

    function checkForm(){
        $msg.text('');
        $msg.css('color','white');
        btn.hide();
        var isPass = true;


        if (!/^\d{6}$/.test($oid.val())) {
            isPass = false;
            $msg.text('Order#格式不符，必須為六位數字');
            $msg.css('color','red');
            btn.show();
            return false;
        }

        if (isPass) {
            $.post('/lookup', $(document.forms[0]).serialize(), function (data) {
                console.log(data);
                if (data.success) {
                    $(".oid").text((data.body.oid));
                    $(".name").text((data.body.name));
                    $(".cellnumber").text((data.body.cellnumber));
                    $(".odate").text((data.body.odate));
                    $(".email").text((data.body.email));



                }
            },'json');
        }
        btn.show();
        return false;
    };
</script>
<%- include('parts/foot.ejs') %>
